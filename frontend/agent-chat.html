<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Certification Agent - Chat Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .chat-container {
            background: white;
            border-radius: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .chat-header {
            background: #007cba;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.agent {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: #007cba;
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.agent .message-content {
            background: white;
            border: 1px solid #e1e5e9;
            border-bottom-left-radius: 5px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .user-avatar {
            background: #28a745;
        }

        .agent-avatar {
            background: #007cba;
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e1e5e9;
        }

        .chat-input-form {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
        }

        .chat-input:focus {
            border-color: #007cba;
        }

        .send-button {
            background: #007cba;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .send-button:hover {
            background: #005a87;
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            padding: 10px 20px;
            font-style: italic;
            color: #666;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .quick-action {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            background: #007cba;
            color: white;
        }

        .deal-card {
            background: #f0f8ff;
            border: 1px solid #007cba;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .deal-header {
            font-weight: bold;
            color: #007cba;
            margin-bottom: 5px;
        }

        .career-path {
            background: #f8fff8;
            border: 1px solid #28a745;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .phase {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Certification Agent</h1>
            <p>Your intelligent assistant for certification deals and career planning</p>
        </div>

        <div class="chat-container">
            <div class="chat-header">
                <h2>Chat with Your Certification Expert</h2>
                <p>Ask about deals, career paths, or certification recommendations</p>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message agent">
                    <div class="message-avatar agent-avatar">AI</div>
                    <div class="message-content">
                        <p>Hello! I'm your AI Certification Agent. I can help you:</p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Find the best certification deals across all major providers</li>
                            <li>Plan your certification career path</li>
                            <li>Analyze eligibility requirements</li>
                            <li>Recommend optimal learning sequences</li>
                        </ul>
                        <p>What would you like to explore today?</p>
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                Agent is thinking...
            </div>

            <div class="chat-input-container">
                <div class="quick-actions">
                    <div class="quick-action" onclick="sendQuickMessage('Find AWS certification deals')">Find AWS Deals
                    </div>
                    <div class="quick-action"
                        onclick="sendQuickMessage('Plan my career path from developer to cloud architect')">Career
                        Planning</div>
                    <div class="quick-action"
                        onclick="sendQuickMessage('What certifications should I get for DevOps?')">DevOps Certs</div>
                    <div class="quick-action" onclick="sendQuickMessage('Compare Azure vs AWS certifications')">Compare
                        Providers</div>
                </div>

                <form class="chat-input-form" id="chatForm">
                    <input type="text" class="chat-input" id="chatInput"
                        placeholder="Ask about certification deals, career paths, or recommendations..." required />
                    <button type="submit" class="send-button" id="sendButton">
                        ‚û§
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const BEDROCK_AGENT_API = 'https://ehvx4tl0lc.execute-api.us-east-1.amazonaws.com/prod/strands';

        const chatMessages = document.getElementById('chatMessages');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');

        let conversationHistory = [];

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = chatInput.value.trim();
            if (message) {
                await sendMessage(message);
                chatInput.value = '';
            }
        });

        function sendQuickMessage(message) {
            sendMessage(message);
        }

        async function sendMessage(message) {
            // Add user message to chat
            addMessage('user', message);

            // Show typing indicator
            showTyping(true);

            try {
                // Call Bedrock Agent API
                const response = await callBedrockAgent(message);

                // Hide typing indicator
                showTyping(false);

                // Add agent response
                addMessage('agent', response);

            } catch (error) {
                showTyping(false);
                addMessage('agent', 'I apologize, but I encountered an error. Please try again or contact support.');
                console.error('Agent API error:', error);
            }
        }

        async function callBedrockAgent(message) {
            // Call the actual Lambda function with proper format
            console.log('ü§ñ Calling agent with message:', message);

            try {
                // Smart intent detection based on user message
                const intent = detectUserIntent(message);
                console.log('üß† Detected intent:', intent);

                let action, payload;

                switch (intent.type) {
                    case 'greeting':
                        return getGreetingResponse();

                    case 'help':
                        return getHelpResponse();

                    case 'career_advice':
                        return getCareerAdviceResponse(message);

                    case 'general_question':
                        return getGeneralResponse(message);

                    case 'discover_deals':
                        action = 'discover_deals';
                        payload = {
                            action: 'discover_deals',
                            providers: intent.providers || ['AWS', 'Azure', 'Google Cloud']
                        };
                        break;

                    case 'save_profile':
                        action = 'save_profile';
                        payload = {
                            action: 'save_profile',
                            user_id: 'chat_user_' + Date.now(),
                            current_role: intent.currentRole || 'Developer',
                            target_role: intent.targetRole || 'Cloud Architect',
                            preferred_cloud: intent.preferredCloud || 'AWS'
                        };
                        break;

                    case 'get_recommendations':
                        action = 'get_recommendations';
                        payload = {
                            action: 'get_recommendations',
                            user_id: 'chat_user'
                        };
                        break;

                    case 'analyze_trends':
                        action = 'analyze_trends';
                        payload = {
                            action: 'analyze_trends'
                        };
                        break;

                    default:
                        // Default to a conversational response instead of always discovering deals
                        return getConversationalResponse(message);
                }

                // Only make API calls for specific actions that need backend data
                if (!action) {
                    return getConversationalResponse(message);
                }

                console.log('üì§ Sending payload:', payload);

                const response = await fetch(BEDROCK_AGENT_API, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    console.error('‚ùå API request failed:', response.status, response.statusText);
                    throw new Error(`Agent API request failed: ${response.status}`);
                }

                const data = await response.json();
                console.log('üì• Received response:', data);

                if (data.success && data.result) {
                    return formatAgentResponse(data.result, action, message);
                } else {
                    throw new Error(data.message || 'Agent returned an error');
                }

            } catch (error) {
                console.error('‚ùå Agent call error:', error);
                return `I apologize, but I encountered an error: ${error.message}. Let me try to help you with some general information about certification deals instead.`;
            }
        }

        function detectUserIntent(message) {
            const lowerMessage = message.toLowerCase();

            // Greeting patterns
            if (/^(hi|hello|hey|good morning|good afternoon|good evening)/.test(lowerMessage)) {
                return { type: 'greeting' };
            }

            // Help patterns
            if (lowerMessage.includes('help') || lowerMessage.includes('what can you do') || lowerMessage.includes('how to')) {
                return { type: 'help' };
            }

            // Career advice patterns
            if (lowerMessage.includes('career') || lowerMessage.includes('path') || lowerMessage.includes('roadmap') ||
                lowerMessage.includes('should i') || lowerMessage.includes('which certification') ||
                lowerMessage.includes('best certification') || lowerMessage.includes('start with')) {
                return { type: 'career_advice' };
            }

            // Deal discovery patterns
            if (lowerMessage.includes('find') && (lowerMessage.includes('deal') || lowerMessage.includes('discount') || lowerMessage.includes('offer'))) {
                const providers = [];
                if (lowerMessage.includes('aws')) providers.push('AWS');
                if (lowerMessage.includes('azure')) providers.push('Azure');
                if (lowerMessage.includes('google') || lowerMessage.includes('gcp')) providers.push('Google Cloud');

                return { type: 'discover_deals', providers: providers.length > 0 ? providers : null };
            }

            // Profile saving patterns
            if (lowerMessage.includes('save') && (lowerMessage.includes('profile') || lowerMessage.includes('preference'))) {
                return { type: 'save_profile' };
            }

            // Recommendations patterns
            if (lowerMessage.includes('recommend') || lowerMessage.includes('suggest') || lowerMessage.includes('advice') ||
                lowerMessage.includes('what should') || lowerMessage.includes('personalized')) {
                return { type: 'get_recommendations' };
            }

            // Trends/analysis patterns
            if (lowerMessage.includes('trend') || lowerMessage.includes('analysis') || lowerMessage.includes('market') ||
                lowerMessage.includes('statistics') || lowerMessage.includes('data')) {
                return { type: 'analyze_trends' };
            }

            // General questions about certifications
            if (lowerMessage.includes('certification') || lowerMessage.includes('exam') || lowerMessage.includes('aws') ||
                lowerMessage.includes('azure') || lowerMessage.includes('google cloud') || lowerMessage.includes('cloud')) {
                return { type: 'general_question' };
            }

            // Default to conversational
            return { type: 'conversational' };
        }

        function getGreetingResponse() {
            return `Hello! üëã I'm your certification deals assistant. I can help you with:

üîç **Finding Deals**: "Find AWS certification deals"
üéØ **Career Advice**: "What certification should I start with?"
üìä **Recommendations**: "Give me personalized suggestions"
üìà **Market Trends**: "Show me certification market trends"
üíæ **Save Profile**: "Save my preferences"

What would you like to know about certification deals and career paths?`;
        }

        function getHelpResponse() {
            return `I'm here to help you with certification deals and career planning! Here's what I can do:

**üîç Deal Discovery**
- "Find AWS deals"
- "Show me Azure discounts"
- "What Google Cloud offers are available?"

**üéØ Career Guidance**
- "What certification should I start with?"
- "Best path from developer to cloud architect"
- "Which AWS certification is right for me?"

**üìä Personalized Help**
- "Give me recommendations"
- "Suggest certifications for my profile"
- "What deals match my goals?"

**üìà Market Insights**
- "Show me market trends"
- "Which provider has the best deals?"
- "Analyze certification data"

Just ask me anything about certifications and I'll help you find the best deals and career path!`;
        }

        function getCareerAdviceResponse(message) {
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('start') || lowerMessage.includes('beginner')) {
                return `üéØ **Great question about starting your certification journey!**

For beginners, I recommend this path:

**1. Start with Fundamentals:**
- AWS Cloud Practitioner (easiest entry point)
- Azure Fundamentals (AZ-900)
- Google Cloud Digital Leader

**2. Then move to Associate level:**
- AWS Solutions Architect Associate
- Azure Administrator Associate
- Google Cloud Associate Engineer

**3. Consider your background:**
- **Developer?** Start with AWS Developer Associate
- **System Admin?** Try Azure Administrator
- **Data focused?** Look at Google Cloud Data Engineer

Would you like me to find current deals for any of these certifications? Just say "Find [provider] deals" and I'll search for you!`;
            }

            if (lowerMessage.includes('aws')) {
                return `üöÄ **AWS Certification Path Advice:**

**For beginners:**
1. AWS Cloud Practitioner (foundational)
2. AWS Solutions Architect Associate (most popular)

**For developers:**
1. AWS Developer Associate
2. AWS DevOps Engineer Professional

**For system admins:**
1. AWS SysOps Administrator Associate
2. AWS Solutions Architect Professional

**Current market insight:** AWS certifications have the highest demand and often the best deals for students.

Want me to find current AWS deals for you? Just ask "Find AWS deals"!`;
            }

            return `üéØ **Career Path Guidance:**

The best certification depends on your goals:

**üèóÔ∏è Architecture Focus:** AWS/Azure Solutions Architect
**üíª Development Focus:** AWS Developer, Azure Developer
**‚òÅÔ∏è Cloud Operations:** AWS SysOps, Azure Administrator  
**üìä Data & Analytics:** Google Cloud Data Engineer, AWS Data Analytics

**My recommendation:** Start with cloud fundamentals, then specialize based on your career goals.

Would you like me to find deals for a specific provider or get personalized recommendations based on your profile?`;
        }

        function getGeneralResponse(message) {
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('aws')) {
                return `‚òÅÔ∏è **About AWS Certifications:**

AWS offers certifications at 4 levels:
- **Foundational:** Cloud Practitioner
- **Associate:** Solutions Architect, Developer, SysOps
- **Professional:** Solutions Architect, DevOps Engineer  
- **Specialty:** Security, Machine Learning, etc.

**Popular deals:** AWS often offers student discounts and free retakes.

Want me to find current AWS deals? Just say "Find AWS deals"!`;
            }

            if (lowerMessage.includes('azure')) {
                return `üî∑ **About Microsoft Azure Certifications:**

Azure certifications are role-based:
- **Fundamentals:** AZ-900 (often free!)
- **Associate:** Administrator, Developer, Security Engineer
- **Expert:** Solutions Architect, DevOps Engineer

**Popular deals:** Microsoft frequently offers free exam vouchers through Microsoft Learn.

Want me to find current Azure deals? Just say "Find Azure deals"!`;
            }

            return `üí° **Certification Information:**

I can help you with certifications from:
- **AWS** (most popular, great for cloud architecture)
- **Microsoft Azure** (enterprise-focused, often free fundamentals)
- **Google Cloud** (data and ML focused, good training credits)

What specific information are you looking for? I can find deals, give career advice, or provide recommendations!`;
        }

        function getConversationalResponse(message) {
            return `I understand you're asking about "${message}". 

I'm specialized in helping with certification deals and career paths. Here are some things I can help you with:

üîç **"Find AWS deals"** - Discover current certification discounts
üéØ **"What certification should I start with?"** - Get career advice  
üìä **"Give me recommendations"** - Personalized suggestions
üìà **"Show me trends"** - Market analysis and insights

What would you like to know about certification deals or career planning?`;
        }

        function formatAgentResponse(result, action, originalMessage) {
            console.log('üé® Formatting response for action:', action);

            switch (action) {
                case 'discover_deals':
                    if (result.deals && result.deals.length > 0) {
                        let response = `üéâ Great! I found ${result.deals_discovered} certification deals for you!\n\n`;

                        result.deals.forEach((deal, index) => {
                            response += `**${index + 1}. ${deal.provider} - ${deal.certification_name}**\n`;
                            response += `üí∞ Discount: ${deal.discount_amount}\n`;
                            response += `üìÖ Expires: ${deal.expiry_date}\n`;
                            response += `üë• Eligibility: ${deal.eligibility}\n`;
                            response += `üîó Source: ${deal.source_url}\n\n`;
                        });

                        // Only show storage message if deals were actually stored
                        if (result.deals_stored > 0) {
                            response += `‚úÖ I've stored ${result.deals_stored} deals in your database for future reference!`;
                        }
                        return response;
                    } else {
                        return "I searched for certification deals but didn't find any current offers. Let me keep looking for you!";
                    }

                case 'save_profile':
                    if (result.status === 'success') {
                        return `‚úÖ Perfect! I've saved your profile successfully. Your preferences are now stored and I can provide personalized recommendations based on your goals.`;
                    } else {
                        return `‚ö†Ô∏è I had trouble saving your profile: ${result.message}. Please try again.`;
                    }

                case 'get_recommendations':
                    if (result.recommendations && result.recommendations.length > 0) {
                        let response = `üéØ Based on your profile, I found ${result.recommendations_count} personalized recommendations:\n\n`;

                        result.recommendations.forEach((rec, index) => {
                            const deal = rec.deal;
                            response += `**${index + 1}. ${deal.provider} - ${deal.certification_name}**\n`;
                            response += `üí° Why this matches: ${rec.reason}\n`;
                            response += `üìä Relevance: ${Math.round(rec.relevance_score * 100)}%\n`;
                            response += `üí∞ Discount: ${deal.discount_amount}\n\n`;
                        });

                        return response;
                    } else {
                        return "I don't have any personalized recommendations yet. Let me discover some deals first, or you can save your profile to get better recommendations!";
                    }

                case 'analyze_trends':
                    if (result.total_deals > 0) {
                        let response = `üìä Here's my analysis of the certification market:\n\n`;
                        response += `üìà Total deals analyzed: ${result.total_deals}\n`;
                        response += `üèÜ Best provider: ${result.best_provider}\n`;
                        response += `üí∞ Total market savings: $${result.total_market_savings}\n`;
                        response += `üìã Deals by provider:\n`;

                        Object.entries(result.deals_by_provider).forEach(([provider, count]) => {
                            response += `   ‚Ä¢ ${provider}: ${count} deals\n`;
                        });

                        return response;
                    } else {
                        return "I don't have enough data to analyze trends yet. Let me discover some deals first!";
                    }

                default:
                    return "I processed your request successfully! How else can I help you with certification deals?";
            }
        }

        function getMockResponse(message) {
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('aws') && lowerMessage.includes('deal')) {
                return formatDealsResponse([
                    {
                        provider: 'AWS',
                        certification: 'Solutions Architect Associate',
                        discount: '50% off for students',
                        eligibility: 'Valid student ID required',
                        expires: '2024-12-31'
                    },
                    {
                        provider: 'AWS',
                        certification: 'Cloud Practitioner',
                        discount: 'Free retake voucher',
                        eligibility: 'First-time test takers',
                        expires: '2024-11-30'
                    }
                ]);
            }

            if (lowerMessage.includes('career') || lowerMessage.includes('path')) {
                return formatCareerPathResponse({
                    summary: 'Recommended path from Developer to Cloud Architect',
                    timeline: '12-18 months',
                    phases: [
                        {
                            name: 'Foundation (3-4 months)',
                            certifications: ['AWS Cloud Practitioner', 'Azure Fundamentals'],
                            focus: 'Cloud basics and core services'
                        },
                        {
                            name: 'Specialization (6-8 months)',
                            certifications: ['AWS Solutions Architect Associate', 'Azure Administrator'],
                            focus: 'Architecture and best practices'
                        },
                        {
                            name: 'Mastery (6-12 months)',
                            certifications: ['AWS Solutions Architect Professional'],
                            focus: 'Advanced architecture and leadership'
                        }
                    ]
                });
            }

            if (lowerMessage.includes('devops')) {
                return `For DevOps roles, I recommend this certification sequence:
                
                **Foundation:**
                - AWS Cloud Practitioner or Azure Fundamentals
                
                **Core DevOps:**
                - AWS Certified DevOps Engineer or Azure DevOps Engineer Expert
                - Docker Certified Associate
                - Kubernetes certifications (CKA/CKAD)
                
                **Advanced:**
                - Terraform Associate
                - Jenkins certifications
                - Security-focused certifications
                
                This path typically takes 8-12 months and costs $800-1200, but I can help you find deals to reduce costs by 30-50%!`;
            }

            if (lowerMessage.includes('compare') && (lowerMessage.includes('azure') || lowerMessage.includes('aws'))) {
                return `**AWS vs Azure Certifications Comparison:**
                
                **AWS Advantages:**
                - Larger market share (more job opportunities)
                - More mature certification program
                - Better community resources
                
                **Azure Advantages:**
                - Strong enterprise integration
                - Growing rapidly in market share
                - Often preferred by Microsoft-centric organizations
                
                **My Recommendation:** Start with AWS if you're new to cloud, as it has more resources and job opportunities. Add Azure certifications later for maximum marketability.
                
                Would you like me to find current deals for either platform?`;
            }

            return `I understand you're asking about "${message}". Let me help you with that!
            
            I can assist with:
            - Finding certification deals across AWS, Azure, Google Cloud, Databricks, and Salesforce
            - Planning your certification career path
            - Analyzing eligibility requirements
            - Comparing different certification options
            
            Could you be more specific about what you'd like to know?`;
        }

        function formatDealsResponse(deals) {
            let response = `I found ${deals.length} great certification deals for you:\n\n`;

            deals.forEach((deal, index) => {
                response += `**${deal.provider} - ${deal.certification}**\n`;
                response += `üí∞ Discount: ${deal.discount}\n`;
                response += `‚úÖ Eligibility: ${deal.eligibility}\n`;
                response += `‚è∞ Expires: ${deal.expires}\n\n`;
            });

            response += `Would you like me to help you check eligibility for any of these deals or find more options?`;

            return response;
        }

        function formatCareerPathResponse(path) {
            let response = `**${path.summary}**\n\n`;
            response += `‚è±Ô∏è **Timeline:** ${path.timeline}\n\n`;
            response += `**Learning Path:**\n\n`;

            path.phases.forEach((phase, index) => {
                response += `**${phase.name}**\n`;
                response += `Focus: ${phase.focus}\n`;
                response += `Certifications: ${phase.certifications.join(', ')}\n\n`;
            });

            response += `Would you like me to find current deals for any of these certifications or adjust the plan based on your specific background?`;

            return response;
        }

        function addMessage(sender, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const avatar = document.createElement('div');
            avatar.className = `message-avatar ${sender}-avatar`;
            avatar.textContent = sender === 'user' ? 'You' : 'AI';

            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';

            // Format message content (convert markdown-like formatting)
            const formattedContent = formatMessageContent(content);
            messageContent.innerHTML = formattedContent;

            if (sender === 'user') {
                messageDiv.appendChild(messageContent);
                messageDiv.appendChild(avatar);
            } else {
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(messageContent);
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Add to conversation history
            conversationHistory.push({ sender, content });
        }

        function formatMessageContent(content) {
            return content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>')
                .replace(/üí∞|‚úÖ|‚è∞|‚è±Ô∏è/g, '<span style="font-size: 1.1em;">$&</span>');
        }

        function showTyping(show) {
            typingIndicator.style.display = show ? 'block' : 'none';
            sendButton.disabled = show;

            if (show) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // Auto-focus input
        chatInput.focus();
    </script>
</body>

</html>