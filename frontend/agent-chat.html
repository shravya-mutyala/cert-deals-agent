<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Certification Agent - Chat Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .chat-container {
            background: white;
            border-radius: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .chat-header {
            background: #007cba;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.agent {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: #007cba;
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.agent .message-content {
            background: white;
            border: 1px solid #e1e5e9;
            border-bottom-left-radius: 5px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .user-avatar {
            background: #28a745;
        }

        .agent-avatar {
            background: #007cba;
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e1e5e9;
        }

        .chat-input-form {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
        }

        .chat-input:focus {
            border-color: #007cba;
        }

        .send-button {
            background: #007cba;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .send-button:hover {
            background: #005a87;
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            padding: 10px 20px;
            font-style: italic;
            color: #666;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .quick-action {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            background: #007cba;
            color: white;
        }

        .deal-card {
            background: #f0f8ff;
            border: 1px solid #007cba;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .deal-header {
            font-weight: bold;
            color: #007cba;
            margin-bottom: 5px;
        }

        .career-path {
            background: #f8fff8;
            border: 1px solid #28a745;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .phase {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Learning Resource Agent</h1>
            <p>Quick access to trusted platforms, docs, and workshops for your certification journey.</p>
        </div>

        <div class="chat-container">
            <div class="chat-header">
                <h2>Find Helpful Resources With Your Expert</h2>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message agent">
                    <div class="message-avatar agent-avatar">AI</div>
                    <div class="message-content">
                        <p>Hello! I'm your AI Certification Agent. I can help you:</p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Find official learning resources from AWS, Azure, Google Cloud, Salesforce, and
                                Databricks</li>
                            <li>Search for specific certification information and answers</li>
                            <li>Plan your certification career path</li>
                            <li>Analyze eligibility requirements</li>
                            <li>Recommend optimal learning sequences</li>
                        </ul>
                        <p>Use the buttons below for quick access to learning resources, or ask me any specific
                            questions about certifications!</p>
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                Agent is thinking...
            </div>

            <div class="chat-input-container">
                <div class="quick-actions">
                    <div class="quick-action" onclick="sendQuickMessage('Find resources for learning AWS')">Find
                        resources for learning AWS</div>
                    <div class="quick-action" onclick="sendQuickMessage('Find resources for learning Azure')">Find
                        resources for learning Azure</div>
                    <div class="quick-action" onclick="sendQuickMessage('Find resources for learning Google Cloud')">
                        Find resources for learning Google Cloud</div>
                    <div class="quick-action" onclick="sendQuickMessage('Find resources for learning Salesforce')">Find
                        resources for learning Salesforce</div>
                    <div class="quick-action" onclick="sendQuickMessage('Find resources for learning Databricks')">Find
                        resources for learning Databricks</div>
                </div>

                <form class="chat-input-form" id="chatForm">
                    <input type="text" class="chat-input" id="chatInput"
                        placeholder="Ask any certification question or use buttons for quick resources..." required />
                    <button type="submit" class="send-button" id="sendButton">
                        ➤
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const BEDROCK_AGENT_API = 'https://ehvx4tl0lc.execute-api.us-east-1.amazonaws.com/prod/strands';

        const chatMessages = document.getElementById('chatMessages');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');

        let conversationHistory = [];

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = chatInput.value.trim();
            if (message) {
                await sendMessage(message);
                chatInput.value = '';
            }
        });

        function sendQuickMessage(message) {
            // Mark as button-triggered for static responses
            sendMessage(message, true);
        }

        async function sendMessage(message, isButtonTriggered = false) {
            // Add user message to chat
            addMessage('user', message);

            // Show typing indicator
            showTyping(true);

            try {
                // Call Bedrock Agent API with button context
                const response = await callBedrockAgent(message, isButtonTriggered);

                // Hide typing indicator
                showTyping(false);

                // Add agent response
                addMessage('agent', response);

            } catch (error) {
                showTyping(false);
                addMessage('agent', 'I apologize, but I encountered an error. Please try again or contact support.');
                console.error('Agent API error:', error);
            }
        }

        async function callBedrockAgent(message, isButtonTriggered = false) {
            // Call the actual Lambda function with proper format
            console.log('INFO: Calling agent with message:', message);

            try {
                // Smart intent detection based on user message and button context
                const intent = detectUserIntent(message, isButtonTriggered);
                console.log('INFO: Detected intent:', intent);

                let action, payload;

                switch (intent.type) {
                    case 'greeting':
                        return getGreetingResponse();

                    case 'help':
                        return getHelpResponse();

                    // NEW: Static learning resources for button-triggered actions
                    case 'static_resources_aws':
                        return getStaticAWSResourcesResponse();

                    case 'static_resources_azure':
                        return getStaticAzureResourcesResponse();

                    case 'static_resources_gcp':
                        return getStaticGCPResourcesResponse();

                    case 'static_resources_salesforce':
                        return getStaticSalesforceResourcesResponse();

                    case 'static_resources_databricks':
                        return getStaticDatabricksResourcesResponse();

                    // Google CSE search for free-form queries
                    case 'google_search':
                        action = 'google_search';
                        payload = {
                            action: 'google_search',
                            query: intent.query,
                            context: 'certification_assistant'
                        };
                        break;

                    case 'save_profile':
                        action = 'save_profile';
                        payload = {
                            action: 'save_profile',
                            user_id: 'chat_user_' + Date.now(),
                            current_role: intent.currentRole || 'Developer',
                            target_role: intent.targetRole || 'Cloud Architect',
                            preferred_cloud: intent.preferredCloud || 'AWS'
                        };
                        break;

                    case 'analyze_trends':
                        action = 'analyze_trends';
                        payload = {
                            action: 'analyze_trends'
                        };
                        break;

                    default:
                        // Default to Google search for unknown queries
                        action = 'google_search';
                        payload = {
                            action: 'google_search',
                            query: message,
                            context: 'general'
                        };
                        break;
                }

                // Only make API calls for specific actions that need backend data
                if (!action) {
                    return getConversationalResponse(message);
                }

                console.log('INFO: Sending payload:', payload);

                const response = await fetch(BEDROCK_AGENT_API, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    console.error('ERROR: API request failed:', response.status, response.statusText);
                    throw new Error(`Agent API request failed: ${response.status}`);
                }

                const data = await response.json();
                console.log('INFO: Received response:', data);

                if (data.success && data.result) {
                    // Check if fallback was used and notify user
                    if (data.result.fallback_used) {
                        console.log('WARNING: Fallback method was used');
                    }
                    if (data.result.api_errors && data.result.api_errors.length > 0) {
                        console.log('WARNING: API errors occurred:', data.result.api_errors);
                    }
                    return formatAgentResponse(data.result, action, message);
                } else {
                    throw new Error(data.message || 'Agent returned an error');
                }

            } catch (error) {
                console.error('ERROR: Agent call error:', error);
                return `I apologize, but I encountered an error: ${error.message}.`;
            }
        }

        function detectUserIntent(message, isButtonTriggered = false) {
            const lowerMessage = message.toLowerCase();

            // If triggered by button, use new static resource responses
            if (isButtonTriggered) {
                if (lowerMessage.includes('learning aws')) return { type: 'static_resources_aws' };
                if (lowerMessage.includes('learning azure')) return { type: 'static_resources_azure' };
                if (lowerMessage.includes('learning google cloud')) return { type: 'static_resources_gcp' };
                if (lowerMessage.includes('learning salesforce')) return { type: 'static_resources_salesforce' };
                if (lowerMessage.includes('learning databricks')) return { type: 'static_resources_databricks' };
            }

            // Keep basic static responses for simple interactions
            if (/^(hi|hello|hey|good morning|good afternoon|good evening)/.test(lowerMessage)) {
                return { type: 'greeting' };
            }

            if (lowerMessage.includes('help') || lowerMessage.includes('what can you do') || lowerMessage.includes('how to')) {
                return { type: 'help' };
            }

            // Everything else → Google CSE search for specific questions
            return { type: 'google_search', query: message };
        }

        function getGreetingResponse() {
            return `Hello! Ask me for official learning resources (e.g., "Find resources for learning AWS/Azure/Google Cloud/Salesforce/Databricks") and I'll share the best starting points.`;
        }

        function getHelpResponse() {
            return `I can share official learning portals, docs, and workshops for major providers. Try:\n\n**Find resources for learning AWS**\n**Find resources for learning Azure**\n**Find resources for learning Google Cloud**\n**Find resources for learning Salesforce**\n**Find resources for learning Databricks**`;
        }

        // ---------- NEW: Static resource responses with clickable links ----------

        function getStaticAWSResourcesResponse() {
            return `**Official AWS Learning Resources**\n\n
• <a href="https://skillbuilder.aws/" target="_blank" rel="noopener noreferrer">AWS Skill Builder</a> — on-demand courses & learning plans<br>
• <a href="https://aws.amazon.com/builder/" target="_blank" rel="noopener noreferrer">AWS Builder Labs</a> — guided hands-on labs<br>
• <a href="https://aws.amazon.com/education/awseducate/" target="_blank" rel="noopener noreferrer">AWS Educate</a> — free beginner content for students/learners<br>
• <a href="https://workshops.aws/" target="_blank" rel="noopener noreferrer">AWS Workshops</a> — curated, hands-on workshops<br>
• <a href="https://docs.aws.amazon.com/" target="_blank" rel="noopener noreferrer">AWS Documentation</a> — service docs, tutorials, best practices<br>
• <a href="https://aws.amazon.com/certification/" target="_blank" rel="noopener noreferrer">AWS Certification</a> — paths, exam guides, prep\n\n
Want anything more specific (e.g., Architect vs. Data)?`;
        }

        function getStaticAzureResourcesResponse() {
            return `**Official Microsoft Azure Learning Resources**\n\n
• <a href="https://learn.microsoft.com/training/" target="_blank" rel="noopener noreferrer">Microsoft Learn</a> — free interactive modules & learning paths<br>
• <a href="https://learn.microsoft.com/azure/" target="_blank" rel="noopener noreferrer">Azure Documentation</a> — service docs, samples, quickstarts<br>
• <a href="https://microsoft.github.io/WhatTheHack/" target="_blank" rel="noopener noreferrer">What The Hack</a> — open-source workshop-style scenarios<br>
• <a href="https://learn.microsoft.com/training/azure/" target="_blank" rel="noopener noreferrer">Azure Learning Paths</a> — curated Azure tracks\n\n
Need resources for a specific role (e.g., Administrator, Developer)?`;
        }

        function getStaticGCPResourcesResponse() {
            return `**Official Google Cloud Learning Resources**\n\n
• <a href="https://www.cloudskillsboost.google/" target="_blank" rel="noopener noreferrer">Cloud Skills Boost</a> — hands-on labs, quests, and courses<br>
• <a href="https://cloud.google.com/training" target="_blank" rel="noopener noreferrer">Google Cloud Training</a> — learning paths & instructor-led training<br>
• <a href="https://cloud.google.com/docs" target="_blank" rel="noopener noreferrer">Google Cloud Docs</a> — product docs & quickstarts<br>
• <a href="https://cloud.google.com/certification" target="_blank" rel="noopener noreferrer">Google Cloud Certification</a> — paths, exam guides, prep\n\n
Want Data/ML-specific tracks? I can point you to the right quests.`;
        }

        function getStaticSalesforceResourcesResponse() {
            return `**Official Salesforce Learning Resources (Trailhead)**\n\n
• <a href="https://trailhead.salesforce.com/" target="_blank" rel="noopener noreferrer">Trailhead</a> — free, gamified learning modules & trails<br>
• <a href="https://trailheadacademy.salesforce.com/certification-overview" target="_blank" rel="noopener noreferrer">Salesforce Credentials</a> — certifications & exam guides<br>
• <a href="https://help.salesforce.com/s/" target="_blank" rel="noopener noreferrer">Salesforce Help & Docs</a> — official product documentation<br>
• <a href="https://trailhead.salesforce.com/superbadges" target="_blank" rel="noopener noreferrer">Superbadges</a> — hands-on, scenario-based challenges\n\n
Tell me your role (Admin/Dev/Consultant) and I’ll suggest a Trailmix.`;
        }

        function getStaticDatabricksResourcesResponse() {
            return `**Official Databricks Learning Resources**\n\n
• <a href="https://www.databricks.com/databricks-academy-labs" target="_blank" rel="noopener noreferrer">Databricks Academy Labs</a> — learning paths, courses, and exams<br>
• <a href="https://docs.databricks.com/" target="_blank" rel="noopener noreferrer">Databricks Documentation</a> — product docs & quickstarts<br>
• <a href="https://www.databricks.com/learn" target="_blank" rel="noopener noreferrer">Learn on Databricks</a> — self-paced content & webinars<br>
• <a href="https://www.databricks.com/resources?type=workshop" target="_blank" rel="noopener noreferrer">Workshops</a> — upcoming workshops & hands-on sessions\n\n
Looking for Data Engineer vs. ML Engineer tracks? I can tailor links.`;
        }

        // ----------------------------------------------------------------------

        function getCareerAdviceResponse(message) {
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('start') || lowerMessage.includes('beginner')) {
                return `**Great question about starting your certification journey!**\n\n
For beginners, consider these fundamentals:\n
• AWS Cloud Practitioner\n
• Azure Fundamentals (AZ-900)\n
• Google Cloud Digital Leader\n\n
Then move to associate/professional based on your role.`;
            }

            if (lowerMessage.includes('aws')) {
                return `**AWS Certification Path Advice:**\n\n
Start with Cloud Practitioner → Solutions Architect Associate (popular), then specialize as needed.`;
            }

            return `**Career Path Guidance:**\n\n
The best certification depends on your goals. Start with fundamentals, then specialize (Architecture, DevOps, Data/ML, Security).`;
        }

        function getGeneralResponse(message) {
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('aws')) {
                return `☁️ **About AWS Certifications:** Foundations → Associate → Professional/Specialty. Ask for "Find resources for learning AWS" to get official links.`;
            }

            if (lowerMessage.includes('azure')) {
                return `🔷 **About Microsoft Azure Certifications:** Role-based. Ask for "Find resources for learning Azure" to see Microsoft Learn links.`;
            }

            return `💡 **Certification Information:** Ask me for resources for AWS, Azure, Google Cloud, Salesforce, or Databricks.`;
        }

        function getConversationalResponse(message) {
            return `I understand you're asking about "${message}". You can say things like "Find resources for learning AWS/Azure/Google Cloud/Salesforce/Databricks".`;
        }

        // (unchanged) other helpers: formatAgentResponse, getMockResponse (unused for resources), etc.
        function formatAgentResponse(result, action, originalMessage) {
            console.log('INFO: Formatting response for action:', action);

            switch (action) {
                case 'google_search':
                    if (result.response_type === 'deal_results') {
                        let response = `**${result.message}**\n\n`;

                        if (result.deals && result.deals.length > 0) {
                            response += `**Found Deals:**\n\n`;
                            result.deals.forEach((deal, index) => {
                                response += `**${index + 1}. ${deal.provider} - ${deal.certification_name || deal.title}**\n`;
                                if (deal.snippet) {
                                    response += `${deal.snippet}\n`;
                                }
                                if (deal.active_challenge) {
                                    response += `🎯 **Active Challenge:** <a href="${deal.challenge_url}" target="_blank" rel="noopener noreferrer">${deal.active_challenge}</a>\n`;
                                }
                                response += `📋 **Source:** <a href="${deal.source_url}" target="_blank" rel="noopener noreferrer">${deal.source_name || 'View Details'}</a>\n`;
                                response += `🏛️ **Official Page:** <a href="https://aws.amazon.com/certification/" target="_blank" rel="noopener noreferrer">AWS Certification</a>\n\n`;
                            });
                        } else {
                            response += `No specific deals found, but you can check the official AWS certification page: <a href="https://aws.amazon.com/certification/" target="_blank" rel="noopener noreferrer">AWS Certification</a>`;
                        }

                        return response;
                    } else if (result.response_type === 'search_results') {
                        let response = `**Here's what I found about "${result.query}":**\n\n`;
                        response += `${result.summary}\n\n`;

                        if (result.sources && result.sources.length > 0) {
                            response += `**Sources:**\n`;
                            result.sources.forEach((source, index) => {
                                response += `${index + 1}. <a href="${source.link}" target="_blank" rel="noopener noreferrer">${source.title}</a>\n`;
                            });
                        }

                        return response;
                    } else if (result.response_type === 'fallback') {
                        return result.message;
                    } else if (result.response_type === 'no_results') {
                        return result.message;
                    } else {
                        return `I searched for "${result.query || originalMessage}" but couldn't find specific results. Try asking about certification topics like AWS, Azure, Google Cloud, Databricks, or Salesforce.`;
                    }

                case 'intelligent_search':
                    if (result.success && result.response_type === 'intelligent_summary') {
                        let response = `**Here's what I found about "${result.query}":**\n\n`;
                        response += `${result.summary}\n\n`;

                        if (result.sources && result.sources.length > 0) {
                            response += `**Sources:**\n`;
                            result.sources.forEach((source, index) => {
                                response += `${index + 1}. <a href="${source.link}" target="_blank" rel="noopener noreferrer">${source.title}</a>\n`;
                            });
                        }

                        if (result.fallback_used) {
                            response += `\n*Note: Used fallback search methods as primary API was unavailable.*`;
                        }

                        return response;
                    } else if (result.success && result.response_type === 'fallback') {
                        return result.message + (result.suggestions ? `\n\n**You might also ask about:**\n${result.suggestions.join('\n')}` : '');
                    } else {
                        return `I'd be happy to help with that question. Let me search for the most current information... ${result.message || 'Please try rephrasing your question or ask about specific certification providers.'}`;
                    }

                default:
                    return "I processed your request successfully! How else can I help you with certification learning resources?";
            }
        }

        function addMessage(sender, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const avatar = document.createElement('div');
            avatar.className = `message-avatar ${sender}-avatar`;
            avatar.textContent = sender === 'user' ? 'You' : 'AI';

            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';

            const formattedContent = formatMessageContent(content);
            messageContent.innerHTML = formattedContent;

            if (sender === 'user') {
                messageDiv.appendChild(messageContent);
                messageDiv.appendChild(avatar);
            } else {
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(messageContent);
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            conversationHistory.push({ sender, content });
        }

        function formatMessageContent(content) {
            return content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
        }

        function showTyping(show) {
            typingIndicator.style.display = show ? 'block' : 'none';
            sendButton.disabled = show;

            if (show) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // Auto-focus input
        chatInput.focus();
    </script>
</body>

</html>